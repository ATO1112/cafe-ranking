<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–«èŒ¶ãƒ©ãƒ³ã‚­ãƒ³ã‚°</title>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* èƒŒæ™¯è¨­å®šï¼ˆã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ */
        body {
            position: relative;
            background: linear-gradient(135deg, #8B4513 0%, #D2B48C 50%, #F5DEB3 100%);
            background-attachment: fixed;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(139, 69, 19, 0.1) 2px,
                rgba(139, 69, 19, 0.1) 4px
            ),
            repeating-linear-gradient(
                90deg,
                transparent,
                transparent 20px,
                rgba(160, 82, 45, 0.1) 20px,
                rgba(160, 82, 45, 0.1) 22px
            );
            pointer-events: none;
            z-index: -1;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤º */
        .item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
            background: linear-gradient(90deg, rgba(255, 248, 220, 0.8), rgba(255, 255, 255, 0.9));
            padding: 15px 20px;
            border-radius: 10px;
            border-left: 5px solid #8B4513;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        }

        .item-info {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        .item-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-right: 15px;
        }

        .item-count {
            font-size: 18px;
            font-weight: bold;
            color: #8B4513;
            min-width: 30px;
        }

        .item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item button {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .item .plus {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .item .plus:hover {
            background: linear-gradient(45deg, #45a049, #3d8b40);
            transform: scale(1.1);
        }

        .item .minus {
            background: linear-gradient(45deg, #f44336, #da190b);
            color: white;
        }

        .item .minus:hover {
            background: linear-gradient(45deg, #da190b, #c41e3a);
            transform: scale(1.1);
        }

        h1, h2 {
            color: #8B4513;
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 10px;
        }

        /* ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º */
        .staff-mode {
            background: linear-gradient(45deg, #ff6b6b, #ffa8a8);
            color: white;
            border: none;
            padding: 15px 20px;
            margin-bottom: 30px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }

        .customer-mode {
            background: linear-gradient(45deg, #51cf66, #8ce99a);
            color: white;
            border: none;
            padding: 15px 20px;
            margin-bottom: 30px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(81, 207, 102, 0.3);
        }

        /* ãƒãƒ£ãƒ¼ãƒˆ */
        .chart-container {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        #chart {
            max-width: 100%;
            height: auto;
        }

        /* ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
        .reset-button {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.2s;
        }

        .reset-button:hover {
            background: linear-gradient(45deg, #f57c00, #ef6c00);
            transform: translateY(-2px);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼ˆã‚¹ãƒãƒ›é‡è¦–ï¼‰ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
                margin: 0;
            }

            h1 {
                font-size: 1.8em;
                margin-bottom: 15px;
            }

            h2 {
                font-size: 1.3em;
                margin-bottom: 15px;
            }

            .item {
                padding: 12px 15px;
                margin: 8px 0;
                flex-direction: row;
                align-items: center;
            }

            .item-name {
                font-size: 14px;
                margin-right: 10px;
                flex: 1;
                min-width: 0;
                word-wrap: break-word;
            }

            .item-count {
                font-size: 16px;
                min-width: 40px;
                text-align: center;
            }

            .item-controls {
                gap: 8px;
                flex-shrink: 0;
            }

            .item button {
                width: 35px;
                height: 35px;
                font-size: 18px;
                touch-action: manipulation;
            }

            .staff-mode, .customer-mode {
                padding: 12px 15px;
                margin-bottom: 20px;
                font-size: 14px;
            }

            .chart-container {
                padding: 15px;
                margin-top: 20px;
            }

            #chart {
                width: 100% !important;
                height: 300px !important;
            }

            .reset-button {
                padding: 8px 15px;
                font-size: 14px;
                margin-top: 15px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }

            h1 {
                font-size: 1.5em;
            }

            .item-name {
                font-size: 13px;
            }

            .item button {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }

            #chart {
                height: 250px !important;
            }
        }

        /* ã‚¿ãƒƒãƒãƒ‡ãƒã‚¤ã‚¹ç”¨ã®èª¿æ•´ */
        @media (hover: none) and (pointer: coarse) {
            .item button {
                min-height: 44px;
                min-width: 44px;
            }

            .item:hover {
                transform: none;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="mode-indicator"></div>
        <h1>â˜• å–«èŒ¶ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h1>
        <div id="item-list"></div>
        <div class="chart-container">
            <h2>ğŸ“Š ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚°ãƒ©ãƒ•</h2>
            <canvas id="chart" width="600" height="400"></canvas>
        </div>
    </div>

    <script>
        // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯
        const urlParams = new URLSearchParams(window.location.search);
        const isStaff = urlParams.get('mode') === 'staff';

        // åº—å“¡ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€ç°¡æ˜“ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
        if (isStaff) {
            const password = prompt("åº—å“¡ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:");
            if (password !== "cafe123") {
                alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™");
                window.location.href = window.location.pathname;
            }
        }

        // ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆ
        const items = [
            "ã¿ãŸã‚‰ã—å›£å­",
            "ãƒ¯ãƒƒãƒ•ãƒ«",
            "ã‚¼ãƒªãƒ¼",
            "å¤ã®å¤œã®å¤¢ã®æƒšã‚Œè–¬",
            "äººé­šå§«ã®æ¶™",
            "ä¸æ€è­°ã®å›½ã®é­”æ³•",
            "ãƒãƒ£ã‚·ãƒ£ãƒã‚³ã®ãŠèŒ¶ä¼štea"
        ];

        const itemCounts = {};
        const itemListDiv = document.getElementById("item-list");

        // ã‚¿ã‚¤ãƒˆãƒ«ã¨è¡¨ç¤ºã‚’å‹•çš„ã«å¤‰æ›´
        document.title = isStaff ? "å–«èŒ¶ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆåº—å“¡ç”¨ï¼‰" : "å–«èŒ¶ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆãŠå®¢æ§˜ç”¨ï¼‰";

        // ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º
        const modeIndicator = document.getElementById('mode-indicator');
        if (isStaff) {
            modeIndicator.innerHTML = '<div class="staff-mode"><strong>ğŸ”§ åº—å“¡ãƒ¢ãƒ¼ãƒ‰</strong> - æ•°é‡ã®å¤‰æ›´ãŒå¯èƒ½ã§ã™<br><button class="reset-button" onclick="resetAllData()">ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ</button></div>';
        } else {
            modeIndicator.innerHTML = '<div class="customer-mode"><strong>ğŸ‘¥ ãŠå®¢æ§˜ç”¨è¡¨ç¤º</strong> - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º</div>';
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚µãƒãƒ¼ãƒˆã‚’ãƒã‚§ãƒƒã‚¯
        function isLocalStorageSupported() {
            try {
                const test = 'localStorageTest';
                localStorage.setItem(test, test);
                localStorage.removeItem(test);
                return true;
            } catch(e) {
                return false;
            }
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        function loadData() {
            items.forEach(item => {
                if (isLocalStorageSupported()) {
                    const savedCount = localStorage.getItem(`cafe_${item}`);
                    itemCounts[item] = savedCount ? parseInt(savedCount) : 0;
                } else {
                    itemCounts[item] = 0;
                }
            });
        }

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        function saveData(item, count) {
            if (isLocalStorageSupported()) {
                try {
                    localStorage.setItem(`cafe_${item}`, count.toString());
                } catch(e) {
                    console.warn('LocalStorageä¿å­˜ã«å¤±æ•—:', e);
                }
            }
            itemCounts[item] = count;
            updateDisplay();
        }

        // è¡¨ç¤ºã‚’æ›´æ–°
        function updateDisplay() {
            items.forEach((item, i) => {
                const countElement = document.getElementById(`count-${item}`);
                if (countElement) {
                    countElement.textContent = itemCounts[item];
                }
                if (chart && chart.data && chart.data.datasets[0]) {
                    chart.data.datasets[0].data[i] = itemCounts[item];
                }
            });
            if (chart) {
                chart.update('none'); // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç„¡ã—ã§æ›´æ–°
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
        function resetAllData() {
            if (confirm('å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                items.forEach(item => {
                    if (isLocalStorageSupported()) {
                        try {
                            localStorage.removeItem(`cafe_${item}`);
                        } catch(e) {
                            console.warn('LocalStorageå‰Šé™¤ã«å¤±æ•—:', e);
                        }
                    }
                    itemCounts[item] = 0;
                });
                updateDisplay();
            }
        }

        // UIä½œæˆ
        items.forEach((item, index) => {
            const div = document.createElement("div");
            div.className = "item";
            
            if (isStaff) {
                div.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item}</div>
                    </div>
                    <div class="item-controls">
                        <button class="minus" title="æ•°é‡ã‚’æ¸›ã‚‰ã™">âˆ’</button>
                        <span class="item-count" id="count-${item}">0</span>
                        <button class="plus" title="æ•°é‡ã‚’å¢—ã‚„ã™">ï¼‹</button>
                    </div>
                `;
            } else {
                div.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${item}</div>
                    </div>
                    <div class="item-count" id="count-${item}">0</div>
                `;
            }
            
            itemListDiv.appendChild(div);

            // åº—å“¡ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ã¿ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
            if (isStaff) {
                const plusBtn = div.querySelector(".plus");
                const minusBtn = div.querySelector(".minus");
                
                if (plusBtn) {
                    plusBtn.onclick = () => {
                        const newCount = itemCounts[item] + 1;
                        saveData(item, newCount);
                    };
                }
                
                if (minusBtn) {
                    minusBtn.onclick = () => {
                        const newCount = Math.max(0, itemCounts[item] - 1);
                        saveData(item, newCount);
                    };
                }
            }
        });

        // Chart.jsåˆæœŸåŒ–
        let chart;
        const ctx = document.getElementById("chart");
        if (ctx) {
            chart = new Chart(ctx.getContext("2d"), {
                type: 'bar',
                data: {
                    labels: items,
                    datasets: [{
                        label: 'å£²ä¸Šæ•°',
                        data: items.map(item => itemCounts[item]),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.8)',
                            'rgba(54, 162, 235, 0.8)',
                            'rgba(255, 205, 86, 0.8)',
                            'rgba(75, 192, 192, 0.8)',
                            'rgba(153, 102, 255, 0.8)',
                            'rgba(255, 159, 64, 0.8)',
                            'rgba(199, 199, 199, 0.8)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 205, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)',
                            'rgba(199, 199, 199, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    devicePixelRatio: window.devicePixelRatio || 1,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: window.innerWidth < 480 ? 12 : 14
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth < 480 ? 10 : 12
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            },
                            ticks: {
                                font: {
                                    size: window.innerWidth < 480 ? 10 : 12
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 500
                    }
                }
            });
        }

        // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        loadData();
        updateDisplay();

        // ãŠå®¢æ§˜ç”¨ã®å ´åˆã€å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆä»–ã®ã‚¿ãƒ–ã§æ›´æ–°ã•ã‚ŒãŸå ´åˆã®å¯¾å¿œï¼‰
        if (!isStaff) {
            // ã‚ˆã‚Šé »ç¹ã«ãƒã‚§ãƒƒã‚¯ï¼ˆ500msï¼‰
            setInterval(() => {
                let hasChanges = false;
                
                if (isLocalStorageSupported()) {
                    items.forEach(item => {
                        try {
                            const savedCount = localStorage.getItem(`cafe_${item}`);
                            const count = savedCount ? parseInt(savedCount) : 0;
                            if (itemCounts[item] !== count) {
                                itemCounts[item] = count;
                                hasChanges = true;
                            }
                        } catch(e) {
                            console.warn('LocalStorageèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
                        }
                    });
                } else {
                    // localStorageãŒä½¿ãˆãªã„å ´åˆã§ã‚‚å®šæœŸçš„ã«å†èª­ã¿è¾¼ã¿ã‚’è©¦è¡Œ
                    loadData();
                    hasChanges = true;
                }
                
                if (hasChanges) {
                    // ã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§è¡¨ç¤º
                    items.forEach((item, i) => {
                        const countElement = document.getElementById(`count-${item}`);
                        if (countElement) {
                            countElement.textContent = itemCounts[item];
                        }
                        if (chart && chart.data && chart.data.datasets[0]) {
                            chart.data.datasets[0].data[i] = itemCounts[item];
                        }
                    });
                    if (chart) {
                        chart.update('none'); // ãƒ¢ãƒã‚¤ãƒ«ã§ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è»½ã
                    }
                }
            }, 500); // 500msæ¯ã«ãƒã‚§ãƒƒã‚¯ï¼ˆã‚ˆã‚Šé«˜é »åº¦ï¼‰
        }

        // storage ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¿½åŠ ï¼ˆä»–ã®ã‚¿ãƒ–ã§ã®å¤‰æ›´ã‚’å³åº§ã«åæ˜ ï¼‰
        if (!isStaff && isLocalStorageSupported()) {
            window.addEventListener('storage', function(e) {
                if (e.key && e.key.startsWith('cafe_')) {
                    const itemName = e.key.replace('cafe_', '');
                    if (items.includes(itemName)) {
                        const newValue = e.newValue ? parseInt(e.newValue) : 0;
                        if (itemCounts[itemName] !== newValue) {
                            itemCounts[itemName] = newValue;
                            updateDisplay();
                        }
                    }
                }
            });
        }

        // ãƒšãƒ¼ã‚¸ã®å¯è¦–æ€§ãŒå¤‰ã‚ã£ãŸæ™‚ã®å‡¦ç†ï¼ˆã‚¹ãƒãƒ›ã§ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ï¼‰
        if (!isStaff) {
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    // ãƒšãƒ¼ã‚¸ãŒå†è¡¨ç¤ºã•ã‚ŒãŸæ™‚ã«å¼·åˆ¶çš„ã«æ›´æ–°
                    setTimeout(() => {
                        loadData();
                        updateDisplay();
                    }, 100);
                }
            });
        }

        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®æ›´æ–°ï¼ˆã‚¹ãƒãƒ›ã§ã‚¢ãƒ—ãƒªåˆ‡ã‚Šæ›¿ãˆæ™‚ï¼‰
        if (!isStaff) {
            window.addEventListener('focus', function() {
                setTimeout(() => {
                    loadData();
                    updateDisplay();
                }, 100);
            });
        }

        // ã‚ªãƒªã‚¨ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å¤‰æ›´æ™‚ã®å‡¦ç†ï¼ˆã‚¹ãƒãƒ›ã®å›è»¢æ™‚ï¼‰
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                if (chart) {
                    chart.resize();
                }
            }, 100);
        });

        // ãƒªã‚µã‚¤ã‚ºæ™‚ã®å‡¦ç†
        window.addEventListener('resize', function() {
            setTimeout(() => {
                if (chart) {
                    // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å‹•çš„ã«èª¿æ•´
                    const isMobile = window.innerWidth < 480;
                    chart.options.plugins.legend.labels.font.size = isMobile ? 12 : 14;
                    chart.options.scales.x.ticks.font.size = isMobile ? 10 : 12;
                    chart.options.scales.y.ticks.font.size = isMobile ? 10 : 12;
                    chart.resize();
                }
            }, 100);
        });
    </script>
</body>
</html>
